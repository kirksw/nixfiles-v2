#!/usr/bin/env bash
set -euo pipefail

GREEN='\033[1;32m'
YELLOW='\033[1;33m'
RED='\033[1;31m'
NC='\033[0m'

if ! command -v nix &>/dev/null; then
  echo -e "${RED}nix not found in PATH${NC}" >&2
  exit 1
fi

if [[ $# -lt 1 ]]; then
  echo -e "${YELLOW}Usage:${NC} $0 <hostname> [--] [extra nixos-rebuild args]"
  echo -e "Example: $0 home-desktop"
  exit 2
fi

HOSTNAME="$1"; shift || true

echo -e "${GREEN}Switching NixOS: ${HOSTNAME}${NC}"
nixos-rebuild switch --flake ".#${HOSTNAME}" "$@"
echo -e "${GREEN}Done.${NC}"
